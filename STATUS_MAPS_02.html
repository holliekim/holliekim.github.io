<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"> 

<title>Status Maps</title>

<link rel="stylesheet" href="https://js.arcgis.com/4.4/esri/css/main.css">
<script src="https://js.arcgis.com/4.4/"></script>


<style>
	#viewDiv { width: 950px; height: 800px;}

	.esri-legend {
      font-size: 0pt;
    }

    .esri-legend__service-label {
    	font-size: 10pt;
    }

    .esri-layer-list{ 
    	width: 230px;
    }

    .esri-layer-list__item-container {
    	height: 30px;
    }

</style>
</head>

<body>
<script type="text/javascript">

//variable
var done;

function expandlayerlist (){
	if (!done){
	done = true;
	var ctSpans = document.getElementsByClassName("esri-layer-list__child-toggle");

	for (var i = 0; i < ctSpans.length; i++){
		ctSpans[i]["data-item"].open = true;
	}
	}
}
</script>

<div id= "viewDiv" ></div>

<script>
require([
	"esri/Map",
	"esri/views/MapView",
	"esri/layers/FeatureLayer",
	"esri/widgets/Home",
	"esri/widgets/LayerList",
	"esri/widgets/Legend",
	"esri/layers/GroupLayer",
	"esri/symbols/TextSymbol",
	"esri/layers/GraphicsLayer",
	"esri/Graphic",
	"esri/geometry/Point",
	"esri/layers/MapImageLayer",
	"esri/layers/TileLayer",
	"esri/PopupTemplate",
	"dojo/domReady!"
], function (Map, MapView, FeatureLayer, Home, LayerList, Legend, GroupLayer, TextSymbol, GraphicsLayer, Graphic, Point, MapImageLayer, TileLayer, PopupTemplate){
	
	var map = new Map({});

	//basemap with few labels
	var basemap = new TileLayer({
		url: "https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer",
		listMode: "hide"
	});

	//mapview 
	var view = new MapView({
		container: "viewDiv",
		map: map,
		extent: {
            xmin: -87.418494,
            ymin: 43.274570,
            xmax: -97.517553,
            ymax: 49.421187,
            spatialReference: 4326
          }
		//center: [-92.4, 46.35],
		//zoom: 6.5
	});

	//disable pop up dock
	view.popup.dockOptions = {buttonEnabled: false};

	//Add dynamic county labels using ESRI's USA map
	var countylabellayer = new MapImageLayer({
		url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/USA/MapServer",
		listMode: "hide",
        sublayers: [{
          id: 3,
          definitionExpression: "state_name = 'Minnesota'",
          popupTemplate:{
          	title: "{name}"
          },
          //make features invisible, keeps labels on
          opacity: 0,
          labelsVisible: true,
          labelingInfo: [{
            labelExpression: "[name]",
            labelPlacement: "always-horizontal",
            symbol: new TextSymbol({
              color: "black",
              font: {
              	family :"calibri",
                size: 8
              }
            })
          }]
      	}]
  	});

	//add label for RLN
	var text = new TextSymbol({
		text: "Red Lake Nation",
		color: "black",
		font: {
			size: 8,
			family: "calibri"
		}
	});

	//graphic layer to hold RLN label
	var glayer = new GraphicsLayer({
		listMode: "hide"
	});

	//create label
	var g = new Graphic();

	g.geometry = new Point(-95.146233, 48.00962);
    g.symbol = text;
    glayer.add(g);


    //home button 
	var homebutton = new Home({
		view: view
	});
	
	//layer list
	var layerlist = new LayerList({
		view: view
	});


	// Add each layer to Group Layer by category
	var geocoding = new GroupLayer ({
		title: "Geocoding",
		visibilityMode: "exclusive",
		
		layers:[
		new FeatureLayer({
			title: "ALI to RCL",
			portalItem:{id: "ef7f797139514ba08e1332d8b32bbfaa"},
			popupEnabled: false
		}),
		new FeatureLayer({
			title: "ALI to ADP",
			portalItem: {id: "7b46fa64799f42a9a2191e8a86e57a61"},
			popupEnabled: false
			
		}),
		new FeatureLayer({
			title: "ADP to RCL",
			portalItem: {id: "699486c81b5c4ad8aa411d3dbe4e0433"},
			popupEnabled: false
		})
		],
		visible: false
	});

	var validation = new GroupLayer ({
		title: "Validation Phase Status",
		visibilityMode: "exclusive",
		layers:[
		new FeatureLayer({
			title: "Addresses",
			portalItem: {id: "6101f17dac9e47d58b5ec8f2c51a12d4"},
			popupEnabled: false
		}),
		
		new FeatureLayer({
			title: "Street Names",
			portalItem: {id: "23f5382a0b874157836ee53ae55c7d10"},
			popupEnabled: false
			
		}),
		new FeatureLayer({
			title: "Community Names",
			portalItem:{id: "0548fe8a577547c6bd7a78beb650f844"},
			popupEnabled: false
			
		}),
		new FeatureLayer({
			title: "Kickoff Meetings",
			portalItem: {id: "f791f11385024eb3b31ab11994a7bf7c"},
			popupEnabled: false
		}),
		],
		
	});

	var datacollect = new GroupLayer({
		title: "Data Collection",
		visibilityMode: "exclusive",
		layers:[
			new FeatureLayer({
				title: "Road Centerlines",
				portalItem:{id:"2faeb06a0eea4552b65db7e306b638ba"},
				popupEnabled: false
			}),
			new FeatureLayer({
				title: "ESZs",
				portalItem: {id: "f7c9b61c166040cda6b9a7e870657671"},
				popupEnabled: false
			}),
			new FeatureLayer ({
				title: "Address Points",
				portalItem:{id:"4ffe231f54c0400d8776180c3eeecfb1"},
				popupEnabled: false
			})
		],
		visible: false
	});

	//add all group layers to main group layer
	var alllayers = new GroupLayer({
		title: "All Layers",
		visibilityMode: "exclusive"
	});

	alllayers.add(datacollect);
	alllayers.add(geocoding);
	alllayers.add(validation);


	//legend
	var legend = new Legend ({
		view: view,
		layerInfos: [{
          layer: geocoding
     	},{
          layer: validation
      },{
      	  layer: datacollect
      }]
     });


	//add basemap and layers
	map.add(basemap);
	map.add(alllayers);
	map.add(glayer);
	map.add(countylabellayer);


	//add buttons, layers, legend
	view.ui.add(homebutton, "top-left");
	view.ui.add(layerlist, "top-right");
	view.ui.add(legend, "bottom-right");

	//wait for last layer to load...the run expandlayer list to open up layerlist 
	view.whenLayerView(countylabellayer).then(function(lyrView){
	  lyrView.watch("updating", function(val){
	    if(!val){  // wait for the layer view to finish updating
	      expandlayerlist();
	    }
	  });
	});


//
});
</script>

</body>
</html>